(function(){var e={2634:function(){},4291:function(e,t,s){"use strict";var a=s(5130),o=s(6768),l=s(4232);const r={class:"logo"},i={class:"header-left"},n={class:"header-right"},d={class:"user-info"},u={class:"username"};function c(e,t,s,a,c,m){const g=(0,o.g2)("Setting"),h=(0,o.g2)("el-icon"),p=(0,o.g2)("House"),b=(0,o.g2)("el-menu-item"),f=(0,o.g2)("UserFilled"),k=(0,o.g2)("Postcard"),_=(0,o.g2)("Picture"),F=(0,o.g2)("Link"),y=(0,o.g2)("Tools"),w=(0,o.g2)("el-sub-menu"),v=(0,o.g2)("Bell"),V=(0,o.g2)("el-menu"),L=(0,o.g2)("el-aside"),U=(0,o.g2)("el-breadcrumb-item"),C=(0,o.g2)("el-breadcrumb"),$=(0,o.g2)("el-avatar"),T=(0,o.g2)("SwitchButton"),W=(0,o.g2)("el-dropdown-item"),P=(0,o.g2)("el-dropdown-menu"),D=(0,o.g2)("el-dropdown"),R=(0,o.g2)("el-header"),x=(0,o.g2)("router-view"),A=(0,o.g2)("el-main"),I=(0,o.g2)("el-footer"),B=(0,o.g2)("el-container");return(0,o.uX)(),(0,o.Wv)(B,{class:"layout-container"},{default:(0,o.k6)(()=>[(0,o.bF)(L,{width:"220px",class:"sidebar"},{default:(0,o.k6)(()=>[(0,o.Lk)("div",r,[(0,o.bF)(h,{size:"30",color:"#409EFF"},{default:(0,o.k6)(()=>[(0,o.bF)(g)]),_:1}),t[0]||(t[0]=(0,o.Lk)("span",{class:"logo-title"},"管理系统",-1))]),(0,o.bF)(V,{"default-active":e.$route.path,class:"sidebar-menu",router:!0,"background-color":"#545c64","text-color":"#fff","active-text-color":"#409EFF"},{default:(0,o.k6)(()=>[(0,o.bF)(b,{index:"/",route:{name:"home"}},{default:(0,o.k6)(()=>[(0,o.bF)(h,null,{default:(0,o.k6)(()=>[(0,o.bF)(p)]),_:1}),t[1]||(t[1]=(0,o.Lk)("span",null,"首页",-1))]),_:1}),m.has_permission("user")?((0,o.uX)(),(0,o.Wv)(b,{key:0,index:"/users",route:{name:"users"}},{default:(0,o.k6)(()=>[(0,o.bF)(h,null,{default:(0,o.k6)(()=>[(0,o.bF)(f)]),_:1}),t[2]||(t[2]=(0,o.Lk)("span",null,"用户管理",-1))]),_:1})):(0,o.Q3)("",!0),(0,o.bF)(b,{index:"/password",route:{name:"password"}},{default:(0,o.k6)(()=>[(0,o.bF)(h,null,{default:(0,o.k6)(()=>[(0,o.bF)(k)]),_:1}),t[3]||(t[3]=(0,o.Lk)("span",null,"密码管理",-1))]),_:1}),m.has_permission("banner")?((0,o.uX)(),(0,o.Wv)(b,{key:1,index:"/banners",route:{name:"banners"}},{default:(0,o.k6)(()=>[(0,o.bF)(h,null,{default:(0,o.k6)(()=>[(0,o.bF)(_)]),_:1}),t[4]||(t[4]=(0,o.Lk)("span",null,"轮播图管理",-1))]),_:1})):(0,o.Q3)("",!0),m.has_permission("link")?((0,o.uX)(),(0,o.Wv)(b,{key:2,index:"/links",route:{name:"links"}},{default:(0,o.k6)(()=>[(0,o.bF)(h,null,{default:(0,o.k6)(()=>[(0,o.bF)(F)]),_:1}),t[5]||(t[5]=(0,o.Lk)("span",null,"链接管理",-1))]),_:1})):(0,o.Q3)("",!0),m.has_permission("tool")?((0,o.uX)(),(0,o.Wv)(w,{key:3,index:"/tools"},{title:(0,o.k6)(()=>[(0,o.bF)(h,null,{default:(0,o.k6)(()=>[(0,o.bF)(y)]),_:1}),t[6]||(t[6]=(0,o.Lk)("span",null,"工具管理",-1))]),default:(0,o.k6)(()=>[(0,o.bF)(b,{index:"/tools/list",route:{name:"toolmanagement"}},{default:(0,o.k6)(()=>[...t[7]||(t[7]=[(0,o.eW)("工具列表",-1)])]),_:1}),(0,o.bF)(b,{index:"/tools/type",route:{name:"tooltype"}},{default:(0,o.k6)(()=>[...t[8]||(t[8]=[(0,o.eW)("工具分类",-1)])]),_:1})]),_:1})):(0,o.Q3)("",!0),m.has_permission("announce")?((0,o.uX)(),(0,o.Wv)(w,{key:4,index:"/announcements"},{title:(0,o.k6)(()=>[(0,o.bF)(h,null,{default:(0,o.k6)(()=>[(0,o.bF)(v)]),_:1}),t[9]||(t[9]=(0,o.Lk)("span",null,"公告管理",-1))]),default:(0,o.k6)(()=>[(0,o.bF)(b,{index:"/announcements/list",route:{name:"announcelist"}},{default:(0,o.k6)(()=>[...t[10]||(t[10]=[(0,o.eW)("公告列表",-1)])]),_:1}),(0,o.bF)(b,{index:"/announcements/add",route:{name:"announceadd"}},{default:(0,o.k6)(()=>[...t[11]||(t[11]=[(0,o.eW)("发布公告",-1)])]),_:1})]),_:1})):(0,o.Q3)("",!0)]),_:1},8,["default-active"])]),_:1}),(0,o.bF)(B,null,{default:(0,o.k6)(()=>[(0,o.bF)(R,{class:"header"},{default:(0,o.k6)(()=>[(0,o.Lk)("div",i,[(0,o.bF)(C,{separator:"/"},{default:(0,o.k6)(()=>[(0,o.bF)(U,{to:{path:"/"}},{default:(0,o.k6)(()=>[...t[12]||(t[12]=[(0,o.eW)("首页",-1)])]),_:1}),(0,o.bF)(U,null,{default:(0,o.k6)(()=>[(0,o.eW)((0,l.v_)(m.currentPageTitle),1)]),_:1})]),_:1})]),(0,o.Lk)("div",n,[(0,o.bF)(D,null,{dropdown:(0,o.k6)(()=>[(0,o.bF)(P,null,{default:(0,o.k6)(()=>[(0,o.bF)(W,{onClick:m.logout},{default:(0,o.k6)(()=>[(0,o.bF)(h,null,{default:(0,o.k6)(()=>[(0,o.bF)(T)]),_:1}),t[13]||(t[13]=(0,o.eW)("退出登录 ",-1))]),_:1},8,["onClick"])]),_:1})]),default:(0,o.k6)(()=>[(0,o.Lk)("div",d,[(0,o.bF)($,{size:"small",src:"https://cube.elemecdn.com/3/7c/3ea6beec64369c2642b92c6726f1epng.png"}),(0,o.Lk)("span",u,(0,l.v_)(this.$auth.user.username)+"【"+(0,l.v_)(e.$auth.user.role.name)+"】",1)])]),_:1})])]),_:1}),(0,o.bF)(A,{class:"main-content"},{default:(0,o.k6)(()=>[(0,o.bF)(x)]),_:1}),(0,o.bF)(I,{class:"footer"},{default:(0,o.k6)(()=>[...t[14]||(t[14]=[(0,o.Lk)("p",null,"© 2025 后台管理系统 - 由 Element Plus 驱动",-1)])]),_:1})]),_:1})]),_:1})}var m={name:"App",computed:{currentPageTitle(){const e={"/":"首页","/users":"用户管理","/banners":"轮播图管理","/links":"链接管理","/tools/list":"工具列表","/tools/type":"工具分类","/announcements/list":"公告列表","/announcements/add":"发布公告"};return e[this.$route.path]||"首页"}},mounted(){this.$auth.is_active||(window.location.href=this.$http.server_host)},methods:{has_permission(e){return this.$auth.user.permissions.indexOf(e)>=0},logout(){this.$auth.clearUserToken(),window.location.href=this.$http.server_host+"/login"}}},g=s(1241);const h=(0,g.A)(m,[["render",c],["__scopeId","data-v-49780b76"]]);var p=h,b=s(7477),f=s(6131),k=(s(4188),s(8512));function _(e,t,s,a,l,r){return t[0]||(t[0]=(0,o.Fv)('<h1 data-v-4f949b18>首页</h1><div class="home-view" data-v-4f949b18><div class="lines" data-v-4f949b18><div class="line-web-access" id="webaccess" data-v-4f949b18></div></div><div class="pies" data-v-4f949b18><div class="pie-tools" id="tools" data-v-4f949b18></div></div><div class="gauges" data-v-4f949b18><h2 class="gauge-title" data-v-4f949b18>服务器指标</h2><div class="gauge-cpu" id="cpu" data-v-4f949b18></div><div class="gauge-memory" id="memory" data-v-4f949b18></div></div><div class="bars" data-v-4f949b18><div class="bar-access-announce" id="announces" data-v-4f949b18></div></div></div>',2))}var F=s(9041),y=s(1219),w={name:"HomeView",mounted(){this.initWebAccess(),this.initGaugeCPU(),this.initGaugeMEM(),this.initPieTools(),this.initBarAccessAnnounce()},methods:{initWebAccess(){this.$http.getWebAccessInfo().then(e=>{var t,s=e.data.xAxis_data,a=e.data.yAxis_data,o=document.getElementById("webaccess"),l=F.Ts(o);t={title:{text:"近期网站访问量"},tooltip:{trigger:"axis"},xAxis:{type:"category",data:s},yAxis:{type:"value"},series:[{data:a,type:"line",smooth:!0}]},t&&l.setOption(t)})},initGaugeCPU(){this.$http.getSysInfo().then(e=>{var t,s=e.data.cpu_usage,a=document.getElementById("cpu"),o=F.Ts(a);t={tooltip:{formatter:"{a} <br/>{b} : {c}%"},series:[{name:"Pressure",type:"gauge",progress:{show:!0},detail:{valueAnimation:!0,formatter:"{value}"},data:[{value:s,name:"CPU使用率"}]}]},t&&o.setOption(t)})},initGaugeMEM(){this.$http.getSysInfo().then(e=>{var t,s=e.data.mem_usage,a=document.getElementById("memory"),o=F.Ts(a);t={tooltip:{formatter:"{a} <br/>{b} : {c}%"},series:[{name:"Pressure",type:"gauge",progress:{show:!0},detail:{valueAnimation:!0,formatter:"{value}"},data:[{value:s,name:"内存使用率"}]}]},t&&o.setOption(t)})},initPieTools(){this.$http.getToolMemu().then(e=>{if(200==e["code"]){var t,s=e.data,a=document.getElementById("tools"),o=F.Ts(a);t={title:{text:"工具类型分布",left:"center"},tooltip:{trigger:"item"},legend:{orient:"vertical",left:"left"},series:[{name:"工具类型",type:"pie",radius:"50%",data:s,emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]},t&&o.setOption(t)}else y.nk.error(e["message"])})},initBarAccessAnnounce(){this.$http.getToolUsageCount().then(e=>{var t,s=e.data.xAxis_data,a=e.data.yAxis_data,o=document.getElementById("announces"),l=F.Ts(o);t={title:{text:"工具使用次数"},tooltip:{trigger:"axis"},xAxis:{type:"category",data:s,axisLabel:{rotate:45,interval:0}},yAxis:{type:"value"},series:[{data:a,type:"bar"}]},t&&l.setOption(t)})}}};const v=(0,g.A)(w,[["render",_],["__scopeId","data-v-4f949b18"]]);var V=v;const L={class:"user-management"},U={class:"toolbar"},C={class:"pagination-container"},$={class:"dialog-footer"},T={class:"dialog-footer"},W={class:"dialog-footer"};function P(e,t,s,a,r,i){const n=(0,o.g2)("el-button"),d=(0,o.g2)("el-table-column"),u=(0,o.g2)("el-tag"),c=(0,o.g2)("el-table"),m=(0,o.g2)("el-pagination"),g=(0,o.g2)("el-input"),h=(0,o.g2)("el-form-item"),p=(0,o.g2)("el-option"),b=(0,o.g2)("el-select"),f=(0,o.g2)("el-form"),k=(0,o.g2)("el-dialog"),_=(0,o.gN)("loading");return(0,o.uX)(),(0,o.CE)("div",L,[(0,o.Lk)("div",U,[i.canManageUsers?((0,o.uX)(),(0,o.Wv)(n,{key:0,type:"primary",onClick:i.openAddUserDialog},{default:(0,o.k6)(()=>[...t[12]||(t[12]=[(0,o.eW)(" 添加用户 ",-1)])]),_:1},8,["onClick"])):(0,o.Q3)("",!0)]),(0,o.bo)(((0,o.uX)(),(0,o.Wv)(c,{data:r.userList,style:{width:"100%"}},{default:(0,o.k6)(()=>[(0,o.bF)(d,{prop:"username",label:"用户名"}),(0,o.bF)(d,{prop:"realname",label:"真实姓名"}),(0,o.bF)(d,{label:"角色"},{default:(0,o.k6)(e=>[255==e.row.role.permissions?((0,o.uX)(),(0,o.Wv)(u,{key:0,type:"danger"},{default:(0,o.k6)(()=>[...t[13]||(t[13]=[(0,o.eW)("超级管理员",-1)])]),_:1})):16==e.row.role.permissions?((0,o.uX)(),(0,o.Wv)(u,{key:1,type:"primary"},{default:(0,o.k6)(()=>[...t[14]||(t[14]=[(0,o.eW)("公告管理员",-1)])]),_:1})):44==e.row.role.permissions?((0,o.uX)(),(0,o.Wv)(u,{key:2,type:"primary"},{default:(0,o.k6)(()=>[...t[15]||(t[15]=[(0,o.eW)("工具管理员",-1)])]),_:1})):62==e.row.role.permissions?((0,o.uX)(),(0,o.Wv)(u,{key:3,type:"warning"},{default:(0,o.k6)(()=>[...t[16]||(t[16]=[(0,o.eW)("网站管理员",-1)])]),_:1})):((0,o.uX)(),(0,o.Wv)(u,{key:4,type:"info"},{default:(0,o.k6)(()=>[...t[17]||(t[17]=[(0,o.eW)("普通用户",-1)])]),_:1}))]),_:1}),(0,o.bF)(d,{label:"状态"},{default:(0,o.k6)(e=>[(0,o.bF)(u,{type:e.row.is_active?"success":"danger"},{default:(0,o.k6)(()=>[(0,o.eW)((0,l.v_)(e.row.is_active?"激活":"禁用"),1)]),_:2},1032,["type"])]),_:1}),(0,o.bF)(d,{prop:"join_time",label:"注册时间"},{default:(0,o.k6)(e=>[(0,o.eW)((0,l.v_)(i.formatDate(e.row.join_time)),1)]),_:1}),(0,o.bF)(d,{label:"操作",width:"250"},{default:(0,o.k6)(e=>[i.canOperateUser(e.row)?((0,o.uX)(),(0,o.Wv)(n,{key:0,size:"small",type:e.row.is_active?"danger":"success",onClick:t=>i.toggleUserStatus(e.row)},{default:(0,o.k6)(()=>[(0,o.eW)((0,l.v_)(e.row.is_active?"禁用":"激活"),1)]),_:2},1032,["type","onClick"])):(0,o.Q3)("",!0),i.canOperateUser(e.row)?((0,o.uX)(),(0,o.Wv)(n,{key:1,size:"small",type:"primary",onClick:t=>i.openEditRoleDialog(e.row)},{default:(0,o.k6)(()=>[...t[18]||(t[18]=[(0,o.eW)(" 修改角色 ",-1)])]),_:1},8,["onClick"])):(0,o.Q3)("",!0),i.canOperateUser(e.row)?((0,o.uX)(),(0,o.Wv)(n,{key:2,size:"small",type:"danger",onClick:t=>i.openDeleteDialog(e.row)},{default:(0,o.k6)(()=>[...t[19]||(t[19]=[(0,o.eW)(" 删除 ",-1)])]),_:1},8,["onClick"])):(0,o.Q3)("",!0)]),_:1})]),_:1},8,["data"])),[[_,r.loading]]),(0,o.Lk)("div",C,[r.total>0?((0,o.uX)(),(0,o.Wv)(m,{key:0,onCurrentChange:i.handlePageChange,"current-page":r.currentPage,"page-size":r.pageSize,layout:"total, prev, pager, next",total:r.total},null,8,["onCurrentChange","current-page","page-size","total"])):(0,o.Q3)("",!0)]),(0,o.bF)(k,{title:"添加用户",modelValue:r.addUserDialogVisible,"onUpdate:modelValue":t[5]||(t[5]=e=>r.addUserDialogVisible=e),width:"500px",onClose:i.resetAddUserForm},{footer:(0,o.k6)(()=>[(0,o.Lk)("span",$,[(0,o.bF)(n,{onClick:t[4]||(t[4]=e=>r.addUserDialogVisible=!1)},{default:(0,o.k6)(()=>[...t[20]||(t[20]=[(0,o.eW)("取消",-1)])]),_:1}),(0,o.bF)(n,{type:"primary",onClick:i.submitAddUserForm},{default:(0,o.k6)(()=>[...t[21]||(t[21]=[(0,o.eW)("确定",-1)])]),_:1},8,["onClick"])])]),default:(0,o.k6)(()=>[(0,o.bF)(f,{model:r.addUserForm,rules:r.addUserFormRules,ref:"addUserFormRef","label-width":"100px"},{default:(0,o.k6)(()=>[(0,o.bF)(h,{label:"用户名",prop:"username"},{default:(0,o.k6)(()=>[(0,o.bF)(g,{modelValue:r.addUserForm.username,"onUpdate:modelValue":t[0]||(t[0]=e=>r.addUserForm.username=e),placeholder:"请输入用户名"},null,8,["modelValue"])]),_:1}),(0,o.bF)(h,{label:"密码",prop:"password"},{default:(0,o.k6)(()=>[(0,o.bF)(g,{modelValue:r.addUserForm.password,"onUpdate:modelValue":t[1]||(t[1]=e=>r.addUserForm.password=e),type:"password",placeholder:"请输入密码","show-password":""},null,8,["modelValue"])]),_:1}),(0,o.bF)(h,{label:"真实姓名",prop:"realname"},{default:(0,o.k6)(()=>[(0,o.bF)(g,{modelValue:r.addUserForm.realname,"onUpdate:modelValue":t[2]||(t[2]=e=>r.addUserForm.realname=e),placeholder:"请输入真实姓名"},null,8,["modelValue"])]),_:1}),(0,o.bF)(h,{label:"角色",prop:"role_id"},{default:(0,o.k6)(()=>[(0,o.bF)(b,{modelValue:r.addUserForm.role_id,"onUpdate:modelValue":t[3]||(t[3]=e=>r.addUserForm.role_id=e),placeholder:"请选择角色",disabled:!i.canSelectRole},{default:(0,o.k6)(()=>[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(i.availableRoles,e=>((0,o.uX)(),(0,o.Wv)(p,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","onClose"]),(0,o.bF)(k,{title:"修改用户角色",modelValue:r.editRoleDialogVisible,"onUpdate:modelValue":t[9]||(t[9]=e=>r.editRoleDialogVisible=e),width:"500px"},{footer:(0,o.k6)(()=>[(0,o.Lk)("span",T,[(0,o.bF)(n,{onClick:t[8]||(t[8]=e=>r.editRoleDialogVisible=!1)},{default:(0,o.k6)(()=>[...t[22]||(t[22]=[(0,o.eW)("取消",-1)])]),_:1}),(0,o.bF)(n,{type:"primary",onClick:i.submitRoleForm},{default:(0,o.k6)(()=>[...t[23]||(t[23]=[(0,o.eW)("确定",-1)])]),_:1},8,["onClick"])])]),default:(0,o.k6)(()=>[(0,o.bF)(f,{model:r.userRoleForm,rules:r.roleFormRules,ref:"userRoleFormRef","label-width":"100px"},{default:(0,o.k6)(()=>[(0,o.bF)(h,{label:"用户名"},{default:(0,o.k6)(()=>[(0,o.bF)(g,{modelValue:r.userRoleForm.username,"onUpdate:modelValue":t[6]||(t[6]=e=>r.userRoleForm.username=e),disabled:""},null,8,["modelValue"])]),_:1}),(0,o.bF)(h,{label:"角色",prop:"role"},{default:(0,o.k6)(()=>[(0,o.bF)(b,{modelValue:r.userRoleForm.role,"onUpdate:modelValue":t[7]||(t[7]=e=>r.userRoleForm.role=e),placeholder:"请选择角色"},{default:(0,o.k6)(()=>[(0,o.bF)(p,{label:"网站管理员",value:"webuser"}),(0,o.bF)(p,{label:"工具管理员",value:"tooluser"}),(0,o.bF)(p,{label:"公告管理员",value:"announceuser"}),(0,o.bF)(p,{label:"普通用户",value:"user"})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"]),(0,o.bF)(k,{title:"提示",modelValue:r.deleteUserVisible,"onUpdate:modelValue":t[11]||(t[11]=e=>r.deleteUserVisible=e),width:"300px",center:""},{footer:(0,o.k6)(()=>[(0,o.Lk)("span",W,[(0,o.bF)(n,{onClick:t[10]||(t[10]=e=>r.deleteUserVisible=!1)},{default:(0,o.k6)(()=>[...t[24]||(t[24]=[(0,o.eW)("取消",-1)])]),_:1}),(0,o.bF)(n,{type:"danger",onClick:i.confirmDelete},{default:(0,o.k6)(()=>[...t[25]||(t[25]=[(0,o.eW)("确定",-1)])]),_:1},8,["onClick"])])]),default:(0,o.k6)(()=>[t[26]||(t[26]=(0,o.Lk)("span",null,"确定要删除这个用户吗？",-1))]),_:1},8,["modelValue"])])}s(4114),s(8111),s(3579);var D={name:"UserManagement",data(){return{loading:!1,userList:[],total:0,currentPage:1,pageSize:10,deleteUserVisible:!1,editRoleDialogVisible:!1,addUserDialogVisible:!1,currentUser:null,userRoleForm:{username:"",role:""},addUserForm:{username:"",password:"111111",realname:"",role_id:1},roleFormRules:{role:[{required:!0,message:"请选择角色",trigger:"change"}]},addUserFormRules:{username:[{required:!0,message:"请输入用户名",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,message:"密码长度至少6位",trigger:"blur"}],realname:[{required:!0,message:"请输入真实姓名",trigger:"blur"}],role_id:[{required:!0,message:"请选择角色",trigger:"change"}]}}},computed:{loggedInUser(){return this.$auth.user},canManageUsers(){return!!this.loggedInUser&&(!(!this.loggedInUser.role||"超级管理员"!==this.loggedInUser.role.name)||!(!this.loggedInUser.role||"网站管理员"!==this.loggedInUser.role.name))},availableRoles(){const e=[];return e.push({label:"普通用户",value:5}),this.loggedInUser.role&&"网站管理员"===this.loggedInUser.role.name?(e.push({label:"工具管理员",value:3}),e.push({label:"公告管理员",value:2}),e):this.loggedInUser.role&&"超级管理员"===this.loggedInUser.role.name?(e.push({label:"工具管理员",value:3}),e.push({label:"公告管理员",value:2}),e.push({label:"网站管理员",value:4}),e):e},canSelectRole(){return this.availableRoles.length>1||1===this.availableRoles.length&&this.addUserForm.role_id!==this.availableRoles[0].value}},mounted(){this.loadUserList(1)},methods:{async loadUserList(e){this.loading=!0;try{const t=await this.$http.getUserList(e);200===t.code?t.data.user_list.length>0?(this.userList=t.data.user_list,this.total=t.data.total_count):(this.userList=[],this.total=0):this.$message.error(t.message||"获取用户列表失败")}catch(t){this.$message.error("加载用户列表失败")}finally{this.loading=!1}},handlePageChange(e){this.currentPage=e,this.loadUserList(e)},canOperateUser(e){return!!this.canManageUsers&&("普通用户"!==this.loggedInUser.role.name&&"工具管理员"!==this.loggedInUser.role.name&&"公告管理员"!==this.loggedInUser.role.name&&(("超级管理员"!==this.loggedInUser.role.name||this.loggedInUser.id!==e.id)&&("网站管理员"!==this.loggedInUser.role.name||"网站管理员"!==e.role.name&&"超级管理员"!==e.role.name)))},async toggleUserStatus(e){if(this.canOperateUser(e))try{const t=e.is_active?0:1,s=await this.$http.activeUser(e.id,t);200===s.code?(this.$message.success((e.is_active?"禁用":"激活")+"用户成功"),this.loadUserList()):this.$message.error(s.message||(e.is_active?"禁用":"激活")+"用户失败")}catch(t){this.$message.error("更新用户状态失败")}else this.$message.error("您没有权限执行此操作")},openAddUserDialog(){this.addUserDialogVisible=!0,this.availableRoles.length>0&&(this.addUserForm.role_id=this.availableRoles[0].value)},resetAddUserForm(){this.addUserForm={username:"",password:"111111",realname:"",role_id:this.availableRoles.length>0?this.availableRoles[0].value:1},this.$refs.addUserFormRef&&this.$refs.addUserFormRef.resetFields()},submitAddUserForm(){this.$refs.addUserFormRef.validate(async e=>{if(e){const e=this.availableRoles.some(e=>e.value===this.addUserForm.role_id);if(!e)return void this.$message.error("您没有权限添加该角色的用户");try{const e=await this.$http.addUser(this.addUserForm);200===e.code?(this.$message.success("添加用户成功"),this.addUserDialogVisible=!1,this.resetAddUserForm(),this.loadUserList()):this.$message.error(e.message||"添加用户失败")}catch(t){this.$message.error("添加用户失败")}}})},openEditRoleDialog(e){this.canOperateUser(e)?(this.currentUser=e,this.userRoleForm.username=e.username,this.userRoleForm.role="",this.editRoleDialogVisible=!0):this.$message.error("您没有权限执行此操作")},submitRoleForm(){this.$refs.userRoleFormRef.validate(async e=>{if(e)try{let e={id:this.currentUser.id};switch(this.userRoleForm.role){case"superuser":e.role_id=1,e.permissions=255;break;case"webuser":e.role_id=4,e.permissions=62;break;case"tooluser":e.role_id=3,e.permissions=44;break;case"announceuser":e.role_id=2,e.permissions=16;break;case"user":e.role_id=5,e.permissions=1;break}const t=await this.$http.updateUserRole(e);200===t.code?(this.$message.success("修改角色成功"),this.editRoleDialogVisible=!1,this.loadUserList(1)):this.$message.error(t.message||"修改角色失败")}catch(t){this.$message.error("修改角色失败")}})},openDeleteDialog(e){this.canOperateUser(e)?(this.currentUser=e,this.deleteUserVisible=!0):this.$message.error("您没有权限执行此操作")},async confirmDelete(){try{const e=await this.$http.deleteUser(this.currentUser.id);200===e.code?(this.$message.success("删除成功"),this.deleteUserVisible=!1,this.loadUserList()):this.$message.error(e.message||"删除失败")}catch(e){this.$message.error("删除用户失败")}},formatDate(e){if(!e)return"";const t=new Date(e);return t.toLocaleDateString()+" "+t.toLocaleTimeString()}}};const R=(0,g.A)(D,[["render",P],["__scopeId","data-v-49f9f604"]]);var x=R;const A={class:"password-management"},I={key:1},B={class:"button-group"},X={class:"dialog-footer"},E={class:"dialog-footer"};function S(e,t,s,a,r,i){const n=(0,o.g2)("el-descriptions-item"),d=(0,o.g2)("el-tag"),u=(0,o.g2)("el-descriptions"),c=(0,o.g2)("el-button"),m=(0,o.g2)("el-card"),g=(0,o.g2)("el-input"),h=(0,o.g2)("el-form-item"),p=(0,o.g2)("el-form"),b=(0,o.g2)("el-dialog"),f=(0,o.g2)("el-option"),k=(0,o.g2)("el-select");return(0,o.uX)(),(0,o.CE)("div",A,[(0,o.bF)(m,{class:"user-info-card"},{header:(0,o.k6)(()=>[...t[8]||(t[8]=[(0,o.Lk)("div",{class:"card-header"},[(0,o.Lk)("span",null,"用户信息")],-1)])]),default:(0,o.k6)(()=>[(0,o.bF)(u,{column:1,border:""},{default:(0,o.k6)(()=>[(0,o.bF)(n,{label:"用户名"},{default:(0,o.k6)(()=>[(0,o.eW)((0,l.v_)(r.currentUser.username||"-"),1)]),_:1}),(0,o.bF)(n,{label:"真实姓名"},{default:(0,o.k6)(()=>[(0,o.eW)((0,l.v_)(r.currentUser.realname||"-"),1)]),_:1}),(0,o.bF)(n,{label:"注册时间"},{default:(0,o.k6)(()=>[(0,o.eW)((0,l.v_)(i.formatDate(r.currentUser.join_time)||"-"),1)]),_:1}),(0,o.bF)(n,{label:"状态"},{default:(0,o.k6)(()=>[void 0!==r.currentUser.is_active?((0,o.uX)(),(0,o.Wv)(d,{key:0,type:r.currentUser.is_active?"success":"danger"},{default:(0,o.k6)(()=>[(0,o.eW)((0,l.v_)(r.currentUser.is_active?"激活":"禁用"),1)]),_:1},8,["type"])):((0,o.uX)(),(0,o.CE)("span",I,"-"))]),_:1}),(0,o.bF)(n,{label:"角色"},{default:(0,o.k6)(()=>[(0,o.eW)((0,l.v_)(r.currentUser.role?.name||"-"),1)]),_:1})]),_:1}),(0,o.Lk)("div",B,[(0,o.bF)(c,{type:"primary",onClick:i.openChangePasswordDialog,disabled:!r.currentUser.id},{default:(0,o.k6)(()=>[...t[9]||(t[9]=[(0,o.eW)("修改密码",-1)])]),_:1},8,["onClick","disabled"]),i.hasPermission(62)?((0,o.uX)(),(0,o.Wv)(c,{key:0,type:"warning",onClick:i.openResetPasswordDialog},{default:(0,o.k6)(()=>[...t[10]||(t[10]=[(0,o.eW)(" 重置密码 ",-1)])]),_:1},8,["onClick"])):(0,o.Q3)("",!0)])]),_:1}),(0,o.bF)(b,{title:"修改密码",modelValue:r.changePasswordDialogVisible,"onUpdate:modelValue":t[4]||(t[4]=e=>r.changePasswordDialogVisible=e),width:"500px",onClose:i.resetChangePasswordForm},{footer:(0,o.k6)(()=>[(0,o.Lk)("span",X,[(0,o.bF)(c,{onClick:t[3]||(t[3]=e=>r.changePasswordDialogVisible=!1)},{default:(0,o.k6)(()=>[...t[11]||(t[11]=[(0,o.eW)("取消",-1)])]),_:1}),(0,o.bF)(c,{type:"primary",onClick:i.submitChangePassword},{default:(0,o.k6)(()=>[...t[12]||(t[12]=[(0,o.eW)("确定",-1)])]),_:1},8,["onClick"])])]),default:(0,o.k6)(()=>[(0,o.bF)(p,{model:r.changePasswordForm,rules:r.changePasswordRules,ref:"changePasswordFormRef","label-width":"100px"},{default:(0,o.k6)(()=>[(0,o.bF)(h,{label:"旧密码",prop:"old_password"},{default:(0,o.k6)(()=>[(0,o.bF)(g,{modelValue:r.changePasswordForm.old_password,"onUpdate:modelValue":t[0]||(t[0]=e=>r.changePasswordForm.old_password=e),type:"password",placeholder:"请输入旧密码","show-password":""},null,8,["modelValue"])]),_:1}),(0,o.bF)(h,{label:"新密码",prop:"new_password"},{default:(0,o.k6)(()=>[(0,o.bF)(g,{modelValue:r.changePasswordForm.new_password,"onUpdate:modelValue":t[1]||(t[1]=e=>r.changePasswordForm.new_password=e),type:"password",placeholder:"请输入新密码","show-password":""},null,8,["modelValue"])]),_:1}),(0,o.bF)(h,{label:"确认密码",prop:"repeat_password"},{default:(0,o.k6)(()=>[(0,o.bF)(g,{modelValue:r.changePasswordForm.repeat_password,"onUpdate:modelValue":t[2]||(t[2]=e=>r.changePasswordForm.repeat_password=e),type:"password",placeholder:"请再次输入新密码","show-password":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","onClose"]),(0,o.bF)(b,{title:"重置密码",modelValue:r.resetPasswordDialogVisible,"onUpdate:modelValue":t[7]||(t[7]=e=>r.resetPasswordDialogVisible=e),width:"500px",onClose:i.resetResetPasswordForm},{footer:(0,o.k6)(()=>[(0,o.Lk)("span",E,[(0,o.bF)(c,{onClick:t[6]||(t[6]=e=>r.resetPasswordDialogVisible=!1)},{default:(0,o.k6)(()=>[...t[13]||(t[13]=[(0,o.eW)("取消",-1)])]),_:1}),(0,o.bF)(c,{type:"warning",onClick:i.submitResetPassword},{default:(0,o.k6)(()=>[...t[14]||(t[14]=[(0,o.eW)("重置密码",-1)])]),_:1},8,["onClick"])])]),default:(0,o.k6)(()=>[(0,o.bF)(p,{model:r.resetPasswordForm,rules:r.resetPasswordRules,ref:"resetPasswordFormRef","label-width":"100px"},{default:(0,o.k6)(()=>[(0,o.bF)(h,{label:"选择用户",prop:"user_id"},{default:(0,o.k6)(()=>[(0,o.bF)(k,{modelValue:r.resetPasswordForm.user_id,"onUpdate:modelValue":t[5]||(t[5]=e=>r.resetPasswordForm.user_id=e),placeholder:"请选择要重置密码的用户",style:{width:"100%"}},{default:(0,o.k6)(()=>[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(r.userList,e=>((0,o.uX)(),(0,o.Wv)(f,{key:e.id,label:e.username,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","onClose"])])}var O={name:"PasswordManagement",data(){const e=(e,t,s)=>{""===t?s(new Error("请再次输入新密码")):t!==this.changePasswordForm.new_password?s(new Error("两次输入的密码不一致")):s()};return{currentUser:{},userList:[],changePasswordDialogVisible:!1,resetPasswordDialogVisible:!1,changePasswordForm:{old_password:"",new_password:"",repeat_password:""},resetPasswordForm:{user_id:"",new_password:""},changePasswordRules:{old_password:[{required:!0,message:"请输入旧密码",trigger:"blur"}],new_password:[{required:!0,message:"请输入新密码",trigger:"blur"},{min:6,message:"密码长度至少6位",trigger:"blur"}],repeat_password:[{required:!0,message:"请再次输入新密码",trigger:"blur"},{validator:e,trigger:"blur"}]},resetPasswordRules:{user_id:[{required:!0,message:"请选择用户",trigger:"change"}]}}},mounted(){this.loadCurrentUser(),this.hasPermission(62)&&this.loadUserList()},methods:{loadCurrentUser(){this.currentUser=this.$auth.user||{}},async loadUserList(){try{const e=await this.$http.getUserList(1);200===e.code?this.userList=e.data.user_list||[]:this.$message.error(e.message||"获取用户列表失败")}catch(e){console.error("获取用户列表失败:",e),this.$message.error("获取用户列表失败")}},hasPermission(e){return this.$auth.user?.role?.permissions>=e},formatDate(e){if(!e)return"-";const t=new Date(e);return t.toLocaleDateString()+" "+t.toLocaleTimeString()},openChangePasswordDialog(){this.changePasswordDialogVisible=!0},openResetPasswordDialog(){this.resetPasswordDialogVisible=!0,0===this.userList.length&&this.hasPermission(62)&&this.loadUserList()},resetChangePasswordForm(){this.changePasswordForm={old_password:"",new_password:"",repeat_password:""},this.$refs.changePasswordFormRef&&this.$refs.changePasswordFormRef.resetFields()},resetResetPasswordForm(){this.resetPasswordForm={user_id:""},this.$refs.resetPasswordFormRef&&this.$refs.resetPasswordFormRef.resetFields()},submitChangePassword(){this.$refs.changePasswordFormRef.validate(async e=>{if(e)try{const e={id:this.currentUser.id,old_password:this.changePasswordForm.old_password,new_password:this.changePasswordForm.new_password,repeat_password:this.changePasswordForm.repeat_password},t=await this.$http.updateUserPassword(e);200===t.code?(this.$message.success("密码修改成功"),this.changePasswordDialogVisible=!1,this.resetChangePasswordForm()):this.$message.error(t.message||"密码修改失败")}catch(t){console.error("密码修改失败:",t),this.$message.error("密码修改失败")}})},submitResetPassword(){this.$refs.resetPasswordFormRef.validate(async e=>{if(e)try{const e={id:this.resetPasswordForm.user_id,new_password:"111111"},t=await this.$http.resetUserPassword(e);200===t.code?(this.$message.success("密码重置成功，已初始化为111111"),this.resetPasswordDialogVisible=!1,this.resetResetPasswordForm()):this.$message.error(t.message||"密码重置失败")}catch(t){console.error("密码重置失败:",t),this.$message.error("密码重置失败")}})}}};const z=(0,g.A)(O,[["render",S],["__scopeId","data-v-5dca2ca9"]]);var q=z;const M={class:"banner-management"},j={class:"toolbar"},Q={class:"image-upload-container"},K={class:"dialog-footer"},H={class:"dialog-footer"};function N(e,t,s,a,l,r){const i=(0,o.g2)("el-button"),n=(0,o.g2)("el-table-column"),d=(0,o.g2)("el-image"),u=(0,o.g2)("el-table"),c=(0,o.g2)("el-input"),m=(0,o.g2)("el-form-item"),g=(0,o.g2)("el-upload"),h=(0,o.g2)("el-form"),p=(0,o.g2)("el-dialog"),b=(0,o.gN)("loading");return(0,o.uX)(),(0,o.CE)("div",M,[(0,o.Lk)("div",j,[(0,o.bF)(i,{type:"primary",onClick:r.openAddDialog},{default:(0,o.k6)(()=>[...t[7]||(t[7]=[(0,o.eW)("添加轮播图",-1)])]),_:1},8,["onClick"])]),(0,o.bo)(((0,o.uX)(),(0,o.Wv)(u,{data:l.bannerList,style:{width:"100%"}},{default:(0,o.k6)(()=>[(0,o.bF)(n,{prop:"name",label:"轮播图名称"}),(0,o.bF)(n,{prop:"image_url",label:"轮播图URL"},{default:(0,o.k6)(e=>[e.row.image_url?((0,o.uX)(),(0,o.Wv)(d,{key:0,src:this.$http.server_host+e.row.image_url,fit:"cover",style:{width:"100px",height:"60px"},"preview-src-list":[e.row.image_url]},null,8,["src","preview-src-list"])):(0,o.Q3)("",!0)]),_:1}),(0,o.bF)(n,{prop:"link_url",label:"跳转链接","show-overflow-tooltip":""}),(0,o.bF)(n,{label:"操作",width:"200"},{default:(0,o.k6)(e=>[(0,o.bF)(i,{size:"small",onClick:t=>r.openEditDialog(e.row)},{default:(0,o.k6)(()=>[...t[8]||(t[8]=[(0,o.eW)("编辑",-1)])]),_:1},8,["onClick"]),(0,o.bF)(i,{size:"small",type:"danger",onClick:t=>r.openDeleteDialog(e.row)},{default:(0,o.k6)(()=>[...t[9]||(t[9]=[(0,o.eW)("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[b,l.loading]]),(0,o.bF)(p,{title:l.dialogTitle,modelValue:l.dialogVisible,"onUpdate:modelValue":t[4]||(t[4]=e=>l.dialogVisible=e),width:"500px",onClose:r.resetForm},{footer:(0,o.k6)(()=>[(0,o.Lk)("span",K,[(0,o.bF)(i,{onClick:t[3]||(t[3]=e=>l.dialogVisible=!1)},{default:(0,o.k6)(()=>[...t[11]||(t[11]=[(0,o.eW)("取消",-1)])]),_:1}),(0,o.bF)(i,{type:"primary",onClick:r.submitForm},{default:(0,o.k6)(()=>[...t[12]||(t[12]=[(0,o.eW)("确定",-1)])]),_:1},8,["onClick"])])]),default:(0,o.k6)(()=>[(0,o.bF)(h,{model:l.bannerForm,rules:l.formRules,ref:"bannerFormRef","label-width":"100px"},{default:(0,o.k6)(()=>[(0,o.bF)(m,{label:"轮播图名称",prop:"name"},{default:(0,o.k6)(()=>[(0,o.bF)(c,{modelValue:l.bannerForm.name,"onUpdate:modelValue":t[0]||(t[0]=e=>l.bannerForm.name=e),placeholder:"请输入图片名称"},null,8,["modelValue"])]),_:1}),(0,o.bF)(m,{label:"轮播图URL",prop:"image_url"},{default:(0,o.k6)(()=>[(0,o.Lk)("div",Q,[(0,o.bF)(c,{modelValue:l.bannerForm.image_url,"onUpdate:modelValue":t[1]||(t[1]=e=>l.bannerForm.image_url=e),placeholder:"请输入图片URL或上传图片",style:{"margin-right":"10px"}},null,8,["modelValue"]),(0,o.bF)(g,{class:"upload-demo",action:r.uploadUrl,headers:r.uploadHeaders,name:"image_url","show-file-list":!1,"on-success":r.handleUploadSuccess,"on-error":r.handleUploadError,"before-upload":r.beforeUpload,accept:"image/jpeg,image/png,image/jpg"},{default:(0,o.k6)(()=>[(0,o.bF)(i,{type:"primary",size:"small",style:{height:"auto"}},{default:(0,o.k6)(()=>[...t[10]||(t[10]=[(0,o.eW)("上传图片",-1)])]),_:1})]),_:1},8,["action","headers","on-success","on-error","before-upload"])])]),_:1}),(0,o.bF)(m,{label:"跳转链接",prop:"link_url"},{default:(0,o.k6)(()=>[(0,o.bF)(c,{modelValue:l.bannerForm.link_url,"onUpdate:modelValue":t[2]||(t[2]=e=>l.bannerForm.link_url=e),placeholder:"请输入图片跳转链接"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue","onClose"]),(0,o.bF)(p,{title:"提示",modelValue:l.deleteBannerVisible,"onUpdate:modelValue":t[6]||(t[6]=e=>l.deleteBannerVisible=e),width:"300px",center:""},{footer:(0,o.k6)(()=>[(0,o.Lk)("span",H,[(0,o.bF)(i,{onClick:t[5]||(t[5]=e=>l.deleteBannerVisible=!1)},{default:(0,o.k6)(()=>[...t[13]||(t[13]=[(0,o.eW)("取消",-1)])]),_:1}),(0,o.bF)(i,{type:"danger",onClick:r.confirmDelete},{default:(0,o.k6)(()=>[...t[14]||(t[14]=[(0,o.eW)("确定",-1)])]),_:1},8,["onClick"])])]),default:(0,o.k6)(()=>[t[15]||(t[15]=(0,o.Lk)("span",null,"确定要删除这个轮播图吗？",-1))]),_:1},8,["modelValue"])])}var G={name:"BannerManagement",data(){return{loading:!1,bannerList:[],dialogVisible:!1,deleteBannerVisible:!1,dialogTitle:"添加轮播图",currentBanner:null,bannerForm:{name:"",image_url:"",link_url:""},formRules:{name:[{required:!0,message:"请输入轮播图名称",trigger:"blur"}],image_url:[{required:!0,message:"请输入轮播图URL",trigger:"blur"}],link_url:[{required:!0,message:"请输入跳转链接",trigger:"blur"}]}}},computed:{uploadUrl(){return this.$http.server_host+"/cmsapi/banner/upload"},uploadHeaders(){return{Authorization:"Bearer "+this.$auth.token}}},mounted(){this.loadBannerList()},methods:{async loadBannerList(){this.loading=!0;try{const e=await this.$http.getBannerList();200===e.code&&(e.data.length>0?this.bannerList=e.data:this.bannerList=[])}catch(e){console.error("加载轮播图列表失败:",e),this.$message.error("加载轮播图列表失败")}finally{this.loading=!1}},openAddDialog(){this.dialogTitle="添加轮播图",this.currentBanner=null,this.dialogVisible=!0},openEditDialog(e){this.dialogTitle="编辑轮播图",this.currentBanner={...e},this.bannerForm={...e},this.dialogVisible=!0},resetForm(){this.bannerForm={name:"",image_url:"",link_url:""},this.currentBanner=null},submitForm(){this.$refs.bannerFormRef.validate(async e=>{if(e)try{let e;e=this.currentBanner?await this.$http.updateBanner({...this.bannerForm,id:this.currentBanner.id}):await this.$http.addBanner(this.bannerForm),200===e.code?(this.$message.success(this.currentBanner?"编辑成功":"添加成功"),this.$http.refreshBanner(),this.dialogVisible=!1,this.resetForm(),this.loadBannerList()):this.$message.error(e.message||(this.currentBanner?"编辑失败":"添加失败"))}catch(t){console.error("保存轮播图失败:",t),this.$message.error("保存轮播图失败")}})},openDeleteDialog(e){this.currentBanner=e,this.deleteBannerVisible=!0},async confirmDelete(){try{const e=await this.$http.deleteBanner(this.currentBanner.id);200===e.code?(this.$message.success("删除成功"),this.$http.refreshBanner(),this.deleteBannerVisible=!1,this.loadBannerList()):this.$message.error(e.message||"删除失败")}catch(e){console.error("删除轮播图失败:",e),this.$message.error("删除轮播图失败")}},beforeUpload(e){const t=e.type.startsWith("image/"),s=e.size/1024/1024<10;return t||this.$message.error("上传图片只能是图片格式!"),s||this.$message.error("上传图片大小不能超过 10MB!"),t&&s},handleUploadSuccess(e){200===e.code?(this.bannerForm.image_url=e.data.image_url,this.$message.success("图片上传成功")):this.$message.error(e.message||"图片上传失败")},handleUploadError(e){this.$message.error("图片上传失败"),console.error("上传失败:",e)}}};const J=(0,g.A)(G,[["render",N],["__scopeId","data-v-36caa676"]]);var Y=J;const Z={class:"link-management"},ee={class:"toolbar"},te=["href"],se={class:"pagination-container"},ae={class:"pagination"},oe={class:"dialog-footer"},le={class:"dialog-footer"};function re(e,t,s,a,r,i){const n=(0,o.g2)("el-button"),d=(0,o.g2)("el-table-column"),u=(0,o.g2)("el-tag"),c=(0,o.g2)("el-table"),m=(0,o.g2)("el-pagination"),g=(0,o.g2)("el-input"),h=(0,o.g2)("el-form-item"),p=(0,o.g2)("el-form"),b=(0,o.g2)("el-dialog"),f=(0,o.gN)("loading");return(0,o.uX)(),(0,o.CE)("div",Z,[(0,o.Lk)("div",ee,[(0,o.bF)(n,{type:"primary",onClick:i.openAddDialog},{default:(0,o.k6)(()=>[...t[6]||(t[6]=[(0,o.eW)("添加链接",-1)])]),_:1},8,["onClick"])]),(0,o.bo)(((0,o.uX)(),(0,o.Wv)(c,{data:r.linkList,style:{width:"100%"}},{default:(0,o.k6)(()=>[(0,o.bF)(d,{prop:"name",label:"链接名称",width:"200"}),(0,o.bF)(d,{prop:"link_url",label:"链接地址","show-overflow-tooltip":""},{default:(0,o.k6)(e=>[(0,o.Lk)("a",{href:e.row.link_url,target:"_blank"},(0,l.v_)(e.row.link_url),9,te)]),_:1}),(0,o.bF)(d,{prop:"create_time",label:"创建时间",width:"200"},{default:(0,o.k6)(e=>[(0,o.eW)((0,l.v_)(i.formatDate(e.row.create_time)),1)]),_:1}),(0,o.bF)(d,{label:"状态",width:"100"},{default:(0,o.k6)(e=>[(0,o.bF)(u,{type:e.row.is_deployed?"success":"danger"},{default:(0,o.k6)(()=>[(0,o.eW)((0,l.v_)(e.row.is_deployed?"已部署":"未部署"),1)]),_:2},1032,["type"])]),_:1}),(0,o.bF)(d,{label:"操作",width:"280"},{default:(0,o.k6)(e=>[(0,o.bF)(n,{size:"small",type:e.row.is_deployed?"danger":"success",onClick:t=>i.toggleDeployStatus(e.row)},{default:(0,o.k6)(()=>[(0,o.eW)((0,l.v_)(e.row.is_deployed?"设为未部署":"设为部署"),1)]),_:2},1032,["type","onClick"]),(0,o.bF)(n,{size:"small",type:"success",onClick:t=>i.openEditDialog(e.row)},{default:(0,o.k6)(()=>[...t[7]||(t[7]=[(0,o.eW)("编辑",-1)])]),_:1},8,["onClick"]),(0,o.bF)(n,{size:"small",type:"danger",onClick:t=>i.openDeleteDialog(e.row)},{default:(0,o.k6)(()=>[...t[8]||(t[8]=[(0,o.eW)("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[f,r.loading]]),(0,o.Lk)("div",se,[(0,o.Lk)("div",ae,[r.total>0?((0,o.uX)(),(0,o.Wv)(m,{key:0,onCurrentChange:i.handlePageChange,"current-page":r.currentPage,layout:"total, prev, pager, next",total:r.total},null,8,["onCurrentChange","current-page","total"])):(0,o.Q3)("",!0)])]),(0,o.bF)(b,{title:r.dialogTitle,modelValue:r.dialogVisible,"onUpdate:modelValue":t[3]||(t[3]=e=>r.dialogVisible=e),width:"500px",onClose:i.resetForm},{footer:(0,o.k6)(()=>[(0,o.Lk)("span",oe,[(0,o.bF)(n,{onClick:t[2]||(t[2]=e=>r.dialogVisible=!1)},{default:(0,o.k6)(()=>[...t[9]||(t[9]=[(0,o.eW)("取消",-1)])]),_:1}),(0,o.bF)(n,{type:"primary",onClick:i.submitForm},{default:(0,o.k6)(()=>[...t[10]||(t[10]=[(0,o.eW)("确定",-1)])]),_:1},8,["onClick"])])]),default:(0,o.k6)(()=>[(0,o.bF)(p,{model:r.linkForm,rules:r.formRules,ref:"linkFormRef","label-width":"100px"},{default:(0,o.k6)(()=>[(0,o.bF)(h,{label:"链接名称",prop:"name"},{default:(0,o.k6)(()=>[(0,o.bF)(g,{modelValue:r.linkForm.name,"onUpdate:modelValue":t[0]||(t[0]=e=>r.linkForm.name=e),placeholder:"请输入链接名称"},null,8,["modelValue"])]),_:1}),(0,o.bF)(h,{label:"链接地址",prop:"link_url"},{default:(0,o.k6)(()=>[(0,o.bF)(g,{modelValue:r.linkForm.link_url,"onUpdate:modelValue":t[1]||(t[1]=e=>r.linkForm.link_url=e),placeholder:"请输入链接地址"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue","onClose"]),(0,o.bF)(b,{title:"提示",modelValue:r.deleteLinkVisible,"onUpdate:modelValue":t[5]||(t[5]=e=>r.deleteLinkVisible=e),width:"300px",center:""},{footer:(0,o.k6)(()=>[(0,o.Lk)("span",le,[(0,o.bF)(n,{onClick:t[4]||(t[4]=e=>r.deleteLinkVisible=!1)},{default:(0,o.k6)(()=>[...t[11]||(t[11]=[(0,o.eW)("取消",-1)])]),_:1}),(0,o.bF)(n,{type:"danger",onClick:i.confirmDelete},{default:(0,o.k6)(()=>[...t[12]||(t[12]=[(0,o.eW)("确定",-1)])]),_:1},8,["onClick"])])]),default:(0,o.k6)(()=>[t[13]||(t[13]=(0,o.Lk)("span",null,"确定要删除这个链接吗？",-1))]),_:1},8,["modelValue"])])}var ie={name:"LinkManagement",data(){return{loading:!1,linkList:[],total:0,currentPage:1,dialogVisible:!1,deleteLinkVisible:!1,dialogTitle:"添加链接",currentLink:null,linkForm:{name:"",link_url:"",is_deployed:1},formRules:{name:[{required:!0,message:"请输入链接名称",trigger:"blur"}],link_url:[{required:!0,message:"请输入链接地址",trigger:"blur"}]}}},mounted(){this.loadLinkList(1)},methods:{async loadLinkList(e){this.loading=!0;try{const t=await this.$http.getLinkList(e);200===t.code?t.data.link_list.length>0?(this.linkList=t.data.link_list,this.total=t.data.total_count,this.currentPage=e):(this.linkList=[],this.total=0,this.currentPage=1):this.$message.error(t.message||"获取链接列表失败")}catch(t){console.error("加载链接列表失败:",t),this.$message.error("加载链接列表失败")}finally{this.loading=!1}},handlePageChange(e){this.loadLinkList(e)},openAddDialog(){this.dialogTitle="添加链接",this.currentLink=null,this.dialogVisible=!0},openEditDialog(e){this.dialogTitle="编辑链接",this.currentLink={...e},this.linkForm={...e},this.dialogVisible=!0},resetForm(){this.linkForm={name:"",link_url:""},this.currentLink=null,this.$refs.linkFormRef&&this.$refs.linkFormRef.resetFields()},submitForm(){this.$refs.linkFormRef.validate(async e=>{if(e)try{let e;e=this.currentLink?await this.$http.updateLink({...this.linkForm,id:this.currentLink.id}):await this.$http.addLink(this.linkForm),200===e.code?(this.$message.success(this.currentLink?"编辑成功":"添加成功"),this.dialogVisible=!1,this.resetForm(),this.loadLinkList()):this.$message.error(e.message||(this.currentLink?"编辑失败":"添加失败"))}catch(t){console.error("保存链接失败:",t),this.$message.error("保存链接失败")}})},openDeleteDialog(e){this.currentLink=e,this.deleteLinkVisible=!0},async confirmDelete(){try{const e=await this.$http.deleteLink(this.currentLink.id);200===e.code?(this.$message.success("删除成功"),this.deleteLinkVisible=!1,this.loadLinkList()):this.$message.error(e.message||"删除失败")}catch(e){console.error("删除链接失败:",e),this.$message.error("删除链接失败")}},async toggleDeployStatus(e){try{const t=e.is_deployed?0:1,s=await this.$http.activeLink(e.id,t);200===s.code?(this.$message.success((e.is_deployed?"取消部署":"部署")+"成功"),this.loadLinkList()):this.$message.error(s.message||(e.is_deployed?"取消部署":"部署")+"失败")}catch(t){console.error("更新状态失败:",t),this.$message.error("更新状态失败")}},formatDate(e){if(!e)return"";const t=new Date(e);return t.toLocaleDateString()+" "+t.toLocaleTimeString()}}};const ne=(0,g.A)(ie,[["render",re],["__scopeId","data-v-178ac2fe"]]);var de=ne;const ue={class:"tool-management"},ce={class:"toolbar"},me=["href"],ge={class:"pagination-container"},he={class:"image-upload-container"},pe={class:"dialog-footer"},be={class:"dialog-footer"};function fe(e,t,s,a,r,i){const n=(0,o.g2)("el-button"),d=(0,o.g2)("el-table-column"),u=(0,o.g2)("el-image"),c=(0,o.g2)("el-table"),m=(0,o.g2)("el-pagination"),g=(0,o.g2)("el-input"),h=(0,o.g2)("el-form-item"),p=(0,o.g2)("el-upload"),b=(0,o.g2)("el-option"),f=(0,o.g2)("el-select"),k=(0,o.g2)("el-form"),_=(0,o.g2)("el-dialog"),F=(0,o.gN)("loading");return(0,o.uX)(),(0,o.CE)("div",ue,[(0,o.Lk)("div",ce,[(0,o.bF)(n,{type:"primary",onClick:i.openAddDialog},{default:(0,o.k6)(()=>[...t[9]||(t[9]=[(0,o.eW)("添加工具",-1)])]),_:1},8,["onClick"])]),(0,o.bo)(((0,o.uX)(),(0,o.Wv)(c,{data:r.toolList,style:{width:"100%"}},{default:(0,o.k6)(()=>[(0,o.bF)(d,{prop:"name",label:"工具名称"}),(0,o.bF)(d,{prop:"description",label:"工具描述","show-overflow-tooltip":""}),(0,o.bF)(d,{label:"工具图标"},{default:(0,o.k6)(t=>[t.row.icon_url?((0,o.uX)(),(0,o.Wv)(u,{key:0,src:e.$http.server_host+t.row.icon_url,fit:"cover",style:{width:"40px",height:"40px"}},null,8,["src"])):(0,o.Q3)("",!0)]),_:1}),(0,o.bF)(d,{prop:"link_url",label:"工具链接","show-overflow-tooltip":""},{default:(0,o.k6)(e=>[(0,o.Lk)("a",{href:e.row.link_url,target:"_blank"},(0,l.v_)(e.row.link_url),9,me)]),_:1}),(0,o.bF)(d,{prop:"type.name",label:"工具分类"}),(0,o.bF)(d,{label:"操作",width:"200"},{default:(0,o.k6)(e=>[(0,o.bF)(n,{size:"small",onClick:t=>i.openEditDialog(e.row)},{default:(0,o.k6)(()=>[...t[10]||(t[10]=[(0,o.eW)("编辑",-1)])]),_:1},8,["onClick"]),(0,o.bF)(n,{size:"small",type:"danger",onClick:t=>i.openDeleteDialog(e.row)},{default:(0,o.k6)(()=>[...t[11]||(t[11]=[(0,o.eW)("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[F,r.loading]]),(0,o.Lk)("div",ge,[r.total>0?((0,o.uX)(),(0,o.Wv)(m,{key:0,onCurrentChange:i.handlePageChange,"current-page":r.currentPage,"page-size":r.pageSize,layout:"total, prev, pager, next",total:r.total},null,8,["onCurrentChange","current-page","page-size","total"])):(0,o.Q3)("",!0)]),(0,o.bF)(_,{title:r.dialogTitle,modelValue:r.dialogVisible,"onUpdate:modelValue":t[6]||(t[6]=e=>r.dialogVisible=e),width:"500px",onClose:i.resetForm},{footer:(0,o.k6)(()=>[(0,o.Lk)("span",pe,[(0,o.bF)(n,{onClick:t[5]||(t[5]=e=>r.dialogVisible=!1)},{default:(0,o.k6)(()=>[...t[13]||(t[13]=[(0,o.eW)("取消",-1)])]),_:1}),(0,o.bF)(n,{type:"primary",onClick:i.submitForm},{default:(0,o.k6)(()=>[...t[14]||(t[14]=[(0,o.eW)("确定",-1)])]),_:1},8,["onClick"])])]),default:(0,o.k6)(()=>[(0,o.bF)(k,{model:r.toolForm,rules:r.formRules,ref:"toolFormRef","label-width":"100px"},{default:(0,o.k6)(()=>[(0,o.bF)(h,{label:"工具名称",prop:"name"},{default:(0,o.k6)(()=>[(0,o.bF)(g,{modelValue:r.toolForm.name,"onUpdate:modelValue":t[0]||(t[0]=e=>r.toolForm.name=e),placeholder:"请输入工具名称"},null,8,["modelValue"])]),_:1}),(0,o.bF)(h,{label:"工具描述",prop:"description"},{default:(0,o.k6)(()=>[(0,o.bF)(g,{modelValue:r.toolForm.description,"onUpdate:modelValue":t[1]||(t[1]=e=>r.toolForm.description=e),type:"textarea",placeholder:"请输入工具描述",rows:3},null,8,["modelValue"])]),_:1}),(0,o.bF)(h,{label:"工具图标",prop:"icon_url"},{default:(0,o.k6)(()=>[(0,o.Lk)("div",he,[(0,o.bF)(g,{modelValue:r.toolForm.icon_url,"onUpdate:modelValue":t[2]||(t[2]=e=>r.toolForm.icon_url=e),placeholder:"请输入图标URL或上传图标",style:{"margin-right":"10px"}},null,8,["modelValue"]),(0,o.bF)(p,{class:"upload-demo",action:e.$http.server_host+"/cmsapi/tool/icon/upload",headers:i.uploadHeaders,name:"icon_url","show-file-list":!1,"on-success":i.handleUploadSuccess,"on-error":i.handleUploadError,"before-upload":i.beforeUpload,accept:"image/jpeg,image/png,image/jpg,image/svg+xml"},{default:(0,o.k6)(()=>[(0,o.bF)(n,{type:"primary",size:"small"},{default:(0,o.k6)(()=>[...t[12]||(t[12]=[(0,o.eW)("上传图标",-1)])]),_:1})]),_:1},8,["action","headers","on-success","on-error","before-upload"])])]),_:1}),(0,o.bF)(h,{label:"工具链接",prop:"link_url"},{default:(0,o.k6)(()=>[(0,o.bF)(g,{modelValue:r.toolForm.link_url,"onUpdate:modelValue":t[3]||(t[3]=e=>r.toolForm.link_url=e),placeholder:"请输入工具链接"},null,8,["modelValue"])]),_:1}),(0,o.bF)(h,{label:"工具分类",prop:"type_name"},{default:(0,o.k6)(()=>[(0,o.bF)(f,{modelValue:r.toolForm.type_name,"onUpdate:modelValue":t[4]||(t[4]=e=>r.toolForm.type_name=e),placeholder:"请选择工具分类",style:{width:"100%"}},{default:(0,o.k6)(()=>[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(r.toolTypeList,e=>((0,o.uX)(),(0,o.Wv)(b,{key:e.name,label:e.name,value:e.name},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue","onClose"]),(0,o.bF)(_,{title:"提示",modelValue:r.deleteToolVisible,"onUpdate:modelValue":t[8]||(t[8]=e=>r.deleteToolVisible=e),width:"300px",center:""},{footer:(0,o.k6)(()=>[(0,o.Lk)("span",be,[(0,o.bF)(n,{onClick:t[7]||(t[7]=e=>r.deleteToolVisible=!1)},{default:(0,o.k6)(()=>[...t[15]||(t[15]=[(0,o.eW)("取消",-1)])]),_:1}),(0,o.bF)(n,{type:"danger",onClick:i.confirmDelete},{default:(0,o.k6)(()=>[...t[16]||(t[16]=[(0,o.eW)("确定",-1)])]),_:1},8,["onClick"])])]),default:(0,o.k6)(()=>[t[17]||(t[17]=(0,o.Lk)("span",null,"确定要删除这个工具吗？",-1))]),_:1},8,["modelValue"])])}var ke={name:"ToolManagement",data(){return{loading:!1,toolList:[],toolTypeList:[],total:0,currentPage:1,pageSize:10,dialogVisible:!1,deleteToolVisible:!1,dialogTitle:"添加工具",currentTool:null,toolForm:{name:"",description:"",icon_url:"",link_url:"",type_name:""},formRules:{name:[{required:!0,message:"请输入工具名称",trigger:"blur"}],description:[{required:!0,message:"请输入工具描述",trigger:"blur"}],icon_url:[{required:!0,message:"请上传工具图标",trigger:"blur"}],link_url:[{required:!0,message:"请输入工具链接",trigger:"blur"}],type_name:[{required:!0,message:"请选择工具分类",trigger:"change"}]}}},computed:{uploadHeaders(){return{Authorization:"Bearer "+this.$auth.token}}},mounted(){this.loadToolList(),this.loadToolTypeList()},methods:{async loadToolList(){this.loading=!0;try{const e=await this.$http.getToolList(this.currentPage);200===e.code?(this.toolList=e.data.tool_list||[],this.total=e.data.total_count||0):this.$message.error(e.message||"获取工具列表失败")}catch(e){console.error("加载工具列表失败:",e),this.$message.error("加载工具列表失败")}finally{this.loading=!1}},async loadToolTypeList(){try{const e=await this.$http.getToolTypeList();200===e.code?e.data.length>0?this.toolTypeList=e.data:this.toolTypeList=[]:this.$message.error(e.message||"获取工具分类列表失败")}catch(e){console.error("加载工具分类列表失败:",e),this.$message.error("加载工具分类列表失败")}},handlePageChange(e){this.currentPage=e,this.loadToolList()},openAddDialog(){this.dialogTitle="添加工具",this.currentTool=null,this.dialogVisible=!0},openEditDialog(e){this.dialogTitle="编辑工具",this.currentTool={...e},console.log(e),this.toolForm={name:e.name,description:e.description,icon_url:e.icon_url,link_url:e.link_url,type_name:e.type?.name||""},this.dialogVisible=!0},resetForm(){this.toolForm={name:"",description:"",icon_url:"",link_url:"",type_name:""},this.currentTool=null,this.$refs.toolFormRef&&this.$refs.toolFormRef.resetFields()},submitForm(){this.$refs.toolFormRef.validate(async e=>{if(e)try{let e;e=this.currentTool?await this.$http.updateTool({...this.toolForm,id:this.currentTool.id}):await this.$http.addTool(this.toolForm),200===e.code?(this.$message.success(this.currentTool?"编辑成功":"添加成功"),this.dialogVisible=!1,this.resetForm(),this.loadToolList()):this.$message.error(e.message||(this.currentTool?"编辑失败":"添加失败"))}catch(t){console.error("保存工具失败:",t),this.$message.error("保存工具失败")}})},openDeleteDialog(e){this.currentTool=e,this.deleteToolVisible=!0},async confirmDelete(){try{const e=await this.$http.deleteTool(this.currentTool.id);200===e.code?(this.$message.success("删除成功"),this.deleteToolVisible=!1,this.loadToolList()):this.$message.error(e.message||"删除失败")}catch(e){console.error("删除工具失败:",e),this.$message.error("删除工具失败")}},beforeUpload(e){const t=e.type.startsWith("image/"),s=e.size/1024/1024<10;return t||this.$message.error("上传图标只能是图片格式!"),s||this.$message.error("上传图标大小不能超过 10MB!"),t&&s},handleUploadSuccess(e){console.log("上传成功:",e),200===e.code?(this.toolForm.icon_url=e.data.icon_url,this.$message.success("图标上传成功")):this.$message.error(e.message||"图标上传失败")},handleUploadError(e){this.$message.error("图标上传失败"),console.error("上传失败:",e)}}};const _e=(0,g.A)(ke,[["render",fe],["__scopeId","data-v-527fdfaf"]]);var Fe=_e;const ye={class:"tool-type"},we={class:"toolbar"},ve=["innerHTML"],Ve=["innerHTML"],Le={style:{"margin-left":"10px"}},Ue={class:"dialog-footer"},Ce={class:"dialog-footer"};function $e(e,t,s,a,r,i){const n=(0,o.g2)("el-button"),d=(0,o.g2)("el-table-column"),u=(0,o.g2)("el-table"),c=(0,o.g2)("el-input"),m=(0,o.g2)("el-form-item"),g=(0,o.g2)("el-input-number"),h=(0,o.g2)("el-option"),p=(0,o.g2)("el-select"),b=(0,o.g2)("el-form"),f=(0,o.g2)("el-dialog"),k=(0,o.gN)("loading");return(0,o.uX)(),(0,o.CE)("div",ye,[(0,o.Lk)("div",we,[(0,o.bF)(n,{type:"primary",onClick:i.openAddDialog},{default:(0,o.k6)(()=>[...t[7]||(t[7]=[(0,o.eW)("添加分类",-1)])]),_:1},8,["onClick"])]),(0,o.bo)(((0,o.uX)(),(0,o.Wv)(u,{data:r.toolTypeList,style:{width:"100%"}},{default:(0,o.k6)(()=>[(0,o.bF)(d,{prop:"name",label:"分类名称"}),(0,o.bF)(d,{prop:"priority",label:"优先级"}),(0,o.bF)(d,{label:"图标"},{default:(0,o.k6)(e=>[(0,o.Lk)("span",{innerHTML:e.row.icon},null,8,ve)]),_:1}),(0,o.bF)(d,{prop:"create_time",label:"创建时间"},{default:(0,o.k6)(e=>[(0,o.eW)((0,l.v_)(i.formatDate(e.row.create_time)),1)]),_:1}),(0,o.bF)(d,{label:"操作",width:"150"},{default:(0,o.k6)(e=>[(0,o.bF)(n,{size:"small",type:"danger",onClick:t=>i.openDeleteDialog(e.row)},{default:(0,o.k6)(()=>[...t[8]||(t[8]=[(0,o.eW)("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[k,r.loading]]),(0,o.bF)(f,{title:"添加工具分类",modelValue:r.dialogVisible,"onUpdate:modelValue":t[4]||(t[4]=e=>r.dialogVisible=e),width:"500px",onClose:i.resetForm},{footer:(0,o.k6)(()=>[(0,o.Lk)("span",Ue,[(0,o.bF)(n,{onClick:t[3]||(t[3]=e=>r.dialogVisible=!1)},{default:(0,o.k6)(()=>[...t[9]||(t[9]=[(0,o.eW)("取消",-1)])]),_:1}),(0,o.bF)(n,{type:"primary",onClick:i.submitForm},{default:(0,o.k6)(()=>[...t[10]||(t[10]=[(0,o.eW)("确定",-1)])]),_:1},8,["onClick"])])]),default:(0,o.k6)(()=>[(0,o.bF)(b,{model:r.toolTypeForm,rules:r.formRules,ref:"toolTypeFormRef","label-width":"100px"},{default:(0,o.k6)(()=>[(0,o.bF)(m,{label:"分类名称",prop:"name"},{default:(0,o.k6)(()=>[(0,o.bF)(c,{modelValue:r.toolTypeForm.name,"onUpdate:modelValue":t[0]||(t[0]=e=>r.toolTypeForm.name=e),placeholder:"请输入分类名称"},null,8,["modelValue"])]),_:1}),(0,o.bF)(m,{label:"优先级",prop:"priority"},{default:(0,o.k6)(()=>[(0,o.bF)(g,{modelValue:r.toolTypeForm.priority,"onUpdate:modelValue":t[1]||(t[1]=e=>r.toolTypeForm.priority=e),min:0,"controls-position":"right"},null,8,["modelValue"])]),_:1}),(0,o.bF)(m,{label:"图标",prop:"icon"},{default:(0,o.k6)(()=>[(0,o.bF)(p,{modelValue:r.toolTypeForm.iconKey,"onUpdate:modelValue":t[2]||(t[2]=e=>r.toolTypeForm.iconKey=e),placeholder:"请选择图标"},{default:(0,o.k6)(()=>[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(r.iconOptions,e=>((0,o.uX)(),(0,o.Wv)(h,{key:e.key,label:e.label,value:e.key},{default:(0,o.k6)(()=>[(0,o.Lk)("span",{innerHTML:e.html},null,8,Ve),(0,o.Lk)("span",Le,(0,l.v_)(e.label),1)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","onClose"]),(0,o.bF)(f,{title:"提示",modelValue:r.deleteToolTypeVisible,"onUpdate:modelValue":t[6]||(t[6]=e=>r.deleteToolTypeVisible=e),width:"300px",center:""},{footer:(0,o.k6)(()=>[(0,o.Lk)("span",Ce,[(0,o.bF)(n,{onClick:t[5]||(t[5]=e=>r.deleteToolTypeVisible=!1)},{default:(0,o.k6)(()=>[...t[11]||(t[11]=[(0,o.eW)("取消",-1)])]),_:1}),(0,o.bF)(n,{type:"danger",onClick:i.confirmToolTypeDelete},{default:(0,o.k6)(()=>[...t[12]||(t[12]=[(0,o.eW)("确定",-1)])]),_:1},8,["onClick"])])]),default:(0,o.k6)(()=>[t[13]||(t[13]=(0,o.Lk)("span",null,"确定要删除这个工具分类吗？",-1))]),_:1},8,["modelValue"])])}s(116);var Te={name:"ToolType",data(){return{loading:!1,toolTypeList:[],dialogVisible:!1,deleteToolTypeVisible:!1,currentToolType:null,toolTypeForm:{name:"",priority:0,iconKey:""},formRules:{name:[{required:!0,message:"请输入分类名称",trigger:"blur"}],priority:[{required:!0,message:"请输入优先级",trigger:"blur"}],iconKey:[{required:!0,message:"请选择图标",trigger:"change"}]},iconOptions:[{key:"star",label:"星星",html:'<i class="fas fa-star me-2 text-warning"></i>'},{key:"heart",label:"心形",html:'<i class="fas fa-heart me-2 text-danger"></i>'},{key:"cloud",label:"云朵",html:'<i class="fas fa-cloud me-2 text-info"></i>'},{key:"code",label:"代码",html:'<i class="fas fa-code me-2 text-danger"></i>'},{key:"cog",label:"齿轮",html:'<i class="fas fa-cog me-2 text-secondary"></i>'},{key:"chart",label:"图像",html:'<i class="fas fa-image me-2 text-success"></i>'},{key:"user",label:"用户",html:'<i class="fas fa-user me-2 text-primary"></i>'},{key:"file",label:"文档",html:'<i class="fas fa-file-alt me-2 text-primary"></i>'},{key:"qrcode",label:"二维码",html:'<i class="fas fa-qrcode me-2 text-secondary"></i>'}]}},mounted(){this.loadToolTypeList()},methods:{async loadToolTypeList(){this.loading=!0;try{const e=await this.$http.getToolTypeList();200===e.code?e.data.length>0?this.toolTypeList=e.data:this.toolTypeList=[]:this.$message.error(e.message||"获取工具分类列表失败")}catch(e){this.$message.error("获取工具分类列表失败")}finally{this.loading=!1}},openAddDialog(){this.dialogVisible=!0},resetForm(){this.toolTypeForm={name:"",priority:0,iconKey:""},this.currentToolType=null,this.$refs.toolTypeFormRef&&this.$refs.toolTypeFormRef.resetFields()},submitForm(){this.$refs.toolTypeFormRef.validate(async e=>{if(e)try{const e=this.iconOptions.find(e=>e.key===this.toolTypeForm.iconKey),t={name:this.toolTypeForm.name,priority:this.toolTypeForm.priority,icon:e?e.html:""},s=await this.$http.addToolType(t);200===s.code?(this.$message.success("添加成功"),this.dialogVisible=!1,this.resetForm(),this.loadToolTypeList()):this.$message.error(s.message||"添加失败")}catch(t){this.$message.error("添加工具分类失败")}})},openDeleteDialog(e){this.currentToolType=e,this.deleteToolTypeVisible=!0},async confirmToolTypeDelete(){try{const e=await this.$http.deleteToolType(this.currentToolType.id);200===e.code?(this.$message.success("删除成功"),this.deleteToolTypeVisible=!1,this.loadToolTypeList()):this.$message.error(e.message||"删除失败")}catch(e){this.$message.error("删除工具分类失败")}},formatDate(e){if(!e)return"";const t=new Date(e);return t.toLocaleDateString()+" "+t.toLocaleTimeString()}}};const We=(0,g.A)(Te,[["render",$e],["__scopeId","data-v-375e9a3e"]]);var Pe=We;const De={class:"announcement-list"},Re={class:"content-preview text-muted"},xe={class:"pagination-container"},Ae={class:"delete-confirm-content"},Ie={class:"dialog-footer"};function Be(e,t,s,a,r,i){const n=(0,o.g2)("el-table-column"),d=(0,o.g2)("el-tag"),u=(0,o.g2)("el-button"),c=(0,o.g2)("el-table"),m=(0,o.g2)("el-pagination"),g=(0,o.g2)("el-card"),h=(0,o.g2)("Warning"),p=(0,o.g2)("el-icon"),b=(0,o.g2)("el-dialog"),f=(0,o.gN)("loading");return(0,o.uX)(),(0,o.CE)("div",De,[(0,o.bF)(g,{class:"announcement-card"},{header:(0,o.k6)(()=>[...t[2]||(t[2]=[(0,o.Lk)("div",{class:"card-header"},[(0,o.Lk)("span",null,"公告列表")],-1)])]),default:(0,o.k6)(()=>[(0,o.bo)(((0,o.uX)(),(0,o.Wv)(c,{data:r.announcementList,style:{width:"100%"},stripe:""},{default:(0,o.k6)(()=>[(0,o.bF)(n,{prop:"title",label:"标题",width:"200"}),(0,o.bF)(n,{label:"内容","min-width":"300"},{default:(0,o.k6)(e=>[(0,o.Lk)("div",Re,(0,l.v_)(e.row.text_muted),1)]),_:1}),(0,o.bF)(n,{prop:"author.realname",label:"发布者",width:"120"}),(0,o.bF)(n,{label:"状态",width:"100"},{default:(0,o.k6)(e=>[(0,o.bF)(d,{type:e.row.is_active?"success":"danger"},{default:(0,o.k6)(()=>[(0,o.eW)((0,l.v_)(e.row.is_active?"已激活":"未激活"),1)]),_:2},1032,["type"])]),_:1}),(0,o.bF)(n,{label:"操作",width:"200"},{default:(0,o.k6)(e=>[(0,o.bF)(u,{size:"small",type:e.row.is_active?"warning":"success",onClick:t=>i.toggleStatus(e.row)},{default:(0,o.k6)(()=>[(0,o.eW)((0,l.v_)(e.row.is_active?"设为未激活":"设为激活"),1)]),_:2},1032,["type","onClick"]),(0,o.bF)(u,{size:"small",type:"danger",onClick:t=>i.openDeleteDialog(e.row)},{default:(0,o.k6)(()=>[...t[3]||(t[3]=[(0,o.eW)(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[f,r.loading]]),(0,o.Lk)("div",xe,[r.total>0?((0,o.uX)(),(0,o.Wv)(m,{key:0,onCurrentChange:i.handlePageChange,"current-page":r.currentPage,"page-size":r.pageSize,layout:"total, prev, pager, next",total:r.total},null,8,["onCurrentChange","current-page","page-size","total"])):(0,o.Q3)("",!0)])]),_:1}),(0,o.bF)(b,{title:"确认删除",modelValue:r.deleteDialogVisible,"onUpdate:modelValue":t[1]||(t[1]=e=>r.deleteDialogVisible=e),width:"30%",center:""},{footer:(0,o.k6)(()=>[(0,o.Lk)("span",Ie,[(0,o.bF)(u,{onClick:t[0]||(t[0]=e=>r.deleteDialogVisible=!1)},{default:(0,o.k6)(()=>[...t[5]||(t[5]=[(0,o.eW)("取消",-1)])]),_:1}),(0,o.bF)(u,{type:"danger",onClick:i.confirmDelete},{default:(0,o.k6)(()=>[...t[6]||(t[6]=[(0,o.eW)("确定删除",-1)])]),_:1},8,["onClick"])])]),default:(0,o.k6)(()=>[(0,o.Lk)("div",Ae,[(0,o.bF)(p,{class:"delete-icon"},{default:(0,o.k6)(()=>[(0,o.bF)(h)]),_:1}),t[4]||(t[4]=(0,o.Lk)("span",null,"确定要删除公告吗？",-1))])]),_:1},8,["modelValue"])])}var Xe={name:"AnnouncementList",data(){return{loading:!1,announcementList:[],total:0,currentPage:1,pageSize:10,deleteDialogVisible:!1,currentAnnouncement:null}},mounted(){this.loadAnnouncementList()},methods:{async loadAnnouncementList(){this.loading=!0;try{const e=await this.$http.getAnnounceList(this.currentPage);200===e.code?(this.announcementList=e.data.announce_list||[],this.total=e.data.total_count||0):this.$message.error(e.message||"获取公告列表失败")}catch(e){console.error("获取公告列表失败:",e),this.$message.error("获取公告列表失败")}finally{this.loading=!1}},handlePageChange(e){this.currentPage=e,this.loadAnnouncementList()},toggleStatus(e){let t=e.is_active?0:1;this.$http.activeAnnounce(e.id,t).then(t=>{console.log("更新状态成功:",t),200===t.code?(this.$message.success((e.is_active?"取消激活":"激活")+"成功"),this.loadAnnouncementList()):this.$message.error(t.message||(e.is_active?"取消激活":"激活")+"失败")}).catch(e=>{console.error("更新状态失败:",e),this.$message.error("更新状态失败")})},openDeleteDialog(e){this.currentAnnouncement=e,this.deleteDialogVisible=!0},async confirmDelete(){try{const e=await this.$http.deleteAnnounce(this.currentAnnouncement.id);200===e.code?(this.$message.success("删除成功"),this.deleteDialogVisible=!1,this.loadAnnouncementList()):this.$message.error(e.message||"删除失败")}catch(e){console.error("删除失败:",e),this.$message.error("删除失败")}}}};const Ee=(0,g.A)(Xe,[["render",Be],["__scopeId","data-v-7906015d"]]);var Se=Ee;const Oe={class:"announcement-add"},ze={style:{border:"1px solid #ccc"}};function qe(e,t,s,a,l,r){const i=(0,o.g2)("el-input"),n=(0,o.g2)("el-form-item"),d=(0,o.g2)("Toolbar"),u=(0,o.g2)("Editor"),c=(0,o.g2)("el-button"),m=(0,o.g2)("el-form"),g=(0,o.g2)("el-card");return(0,o.uX)(),(0,o.CE)("div",Oe,[(0,o.bF)(g,{class:"announcement-card"},{header:(0,o.k6)(()=>[...t[2]||(t[2]=[(0,o.Lk)("div",{class:"card-header"},[(0,o.Lk)("span",null,"发布公告")],-1)])]),default:(0,o.k6)(()=>[(0,o.bF)(m,{model:l.announcementForm,rules:l.formRules,ref:"announcementFormRef","label-width":"100px"},{default:(0,o.k6)(()=>[(0,o.bF)(n,{label:"公告标题",prop:"title"},{default:(0,o.k6)(()=>[(0,o.bF)(i,{modelValue:l.announcementForm.title,"onUpdate:modelValue":t[0]||(t[0]=e=>l.announcementForm.title=e),placeholder:"请输入公告标题",maxlength:"100","show-word-limit":""},null,8,["modelValue"])]),_:1}),(0,o.bF)(n,{label:"公告内容",prop:"content"},{default:(0,o.k6)(()=>[(0,o.Lk)("div",ze,[(0,o.bF)(d,{style:{"border-bottom":"1px solid #ccc"},editor:a.editorRef,defaultConfig:a.toolbarConfig,mode:a.mode},null,8,["editor","defaultConfig","mode"]),(0,o.bF)(u,{style:{height:"500px","overflow-y":"hidden"},modelValue:l.announcementForm.content,"onUpdate:modelValue":t[1]||(t[1]=e=>l.announcementForm.content=e),defaultConfig:a.editorConfig,mode:a.mode,onOnCreated:a.handleCreated},null,8,["modelValue","defaultConfig","mode","onOnCreated"])])]),_:1}),(0,o.bF)(n,null,{default:(0,o.k6)(()=>[(0,o.bF)(c,{type:"primary",onClick:r.submitForm},{default:(0,o.k6)(()=>[...t[3]||(t[3]=[(0,o.eW)("发布",-1)])]),_:1},8,["onClick"]),(0,o.bF)(c,{onClick:r.resetForm},{default:(0,o.k6)(()=>[...t[4]||(t[4]=[(0,o.eW)("重置",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["model","rules"])]),_:1})])}var Me=s(144),je=s(6925),Qe={name:"AnnouncementAdd",components:{Editor:je.K,Toolbar:je.M},setup(){const e=(0,Me.IJ)(),t={excludeKeys:["group-image","group-video","todo"]},s={placeholder:"请输入内容..."};(0,o.xo)(()=>{const t=e.value;null!=t&&t.destroy()});const a=t=>{e.value=t};return{editorRef:e,mode:"default",toolbarConfig:t,editorConfig:s,handleCreated:a}},data(){return{announcementForm:{title:"",content:""},formRules:{title:[{required:!0,message:"请输入公告标题",trigger:"blur"},{min:1,max:100,message:"长度在 1 到 100 个字符",trigger:"blur"}],content:[{required:!0,message:"请输入公告内容",trigger:"blur"}]},announcementFormRef:null}},methods:{submitForm(){this.$refs.announcementFormRef.validate(async e=>{if(e)try{const e=await this.$http.addAnnounce(this.announcementForm);200===e.code?(this.$message.success("公告发布成功"),this.resetForm(),this.$router.push({name:"announcelist"})):this.$message.error(e.message||"公告发布失败")}catch(t){console.error("发布公告失败:",t),this.$message.error("公告发布失败")}})},resetForm(){this.$refs.announcementFormRef.resetFields(),this.announcementForm.content=""}}};const Ke=(0,g.A)(Qe,[["render",qe],["__scopeId","data-v-51b4545b"]]);var He=Ke;const Ne=[{path:"/",component:V,name:"home"},{path:"/users",component:x,name:"users"},{path:"/password",component:q,name:"password"},{path:"/banners",component:Y,name:"banners"},{path:"/links",component:de,name:"links"},{path:"/tools",name:"tools",redirect:"/tools/list",children:[{path:"list",component:Fe,name:"toolmanagement"},{path:"type",component:Pe,name:"tooltype"}]},{path:"/announcements",name:"announcements",redirect:"/announcements/list",children:[{path:"list",component:Se,name:"announcelist"},{path:"add",component:He,name:"announceadd"}]}],Ge=(0,k.aE)({history:(0,k.LA)(),routes:Ne});var Je=Ge;const Ye="USER_KEY",Ze="JWT_TOKEN_KEY";class et{constructor(){this.token=null,this.user=null,this.token=localStorage.getItem(Ze);const e=localStorage.getItem(Ye);e&&(this.user=JSON.parse(e))}static getInstance(){return this._instance||(this._instance=new et),this._instance}setUserToken(e,t){this.user=e,this.token=t,localStorage.setItem(Ye,JSON.stringify(e)),localStorage.setItem(Ze,t)}clearUserToken(){this.user=null,this.token=null,localStorage.removeItem(Ye),localStorage.removeItem(Ze)}get is_authed(){return!(!this.user||!this.token)}get is_active(){return!!this.is_authed&&!!this.user.is_active}}var tt=et.getInstance(),st=s(4373),at=s(9122),ot=s.n(at);class lt{constructor(){this.server_host=window.location.origin,this.http=st.A.create({baseURL:this.server_host+"/cmsapi",timeout:6e4}),this.http.interceptors.request.use(e=>{const t=tt.token;return t&&(e.headers.Authorization="Bearer "+t),e}),this.http.interceptors.response.use(e=>e.data)}_post(e,t){return this.http.post(e,ot().stringify(t))}addBanner(e){const t="/banner/add";return this._post(t,e)}getBannerList(){const e="/banner/list";return this.http.get(e)}deleteBanner(e){const t="/banner/delete";return this._post(t,{id:e})}updateBanner(e){const t="/banner/update";return this._post(t,e)}refreshBanner(){const e="/banner/refresh";return this.http.get(e)}getAnnounceList(e){const t="/announce/list?page="+(e||1);return this.http.get(t)}addAnnounce(e){const t="/announce/add";return this._post(t,e)}deleteAnnounce(e){const t="/announce/delete";return this._post(t,{id:e})}activeAnnounce(e,t){const s="/announce/active?id="+e+"&is_active="+t;return this._post(s,{id:e,is_active:t})}getCommentList(e){const t="/comment/list?page="+(e||1);return this.http.get(t)}deleteComment(e){const t="/comment/delete";return this._post(t,{id:e})}getToolTypeList(){const e="/tooltype/list";return this.http.get(e)}addToolType(e){const t="/tooltype/add";return this._post(t,e)}deleteToolType(e){const t="/tooltype/delete";return this._post(t,{id:e})}getToolList(e){const t="/tool/list?page="+(e||1);return this.http.get(t)}addTool(e){const t="/tool/add";return this._post(t,e)}deleteTool(e){const t="/tool/delete";return this._post(t,{id:e})}updateTool(e){const t="/tool/update";return this._post(t,e)}getLinkList(e){const t="/link/list?page="+(e||1);return this.http.get(t)}addLink(e){const t="/link/add";return this._post(t,e)}deleteLink(e){const t="/link/delete";return this._post(t,{id:e})}updateLink(e){const t="/link/update";return this._post(t,e)}activeLink(e,t){const s="/link/deploy/status?id="+e+"&is_deployed="+t;return this._post(s,{id:e,is_deployed:t})}getUserList(e){const t="/user/list?page="+(e||1);return this.http.get(t)}activeUser(e,t){const s="/user/active?id="+e+"&is_active="+t;return this._post(s,{id:e,is_active:t})}addUser(e){const t="/user/add";return this._post(t,e)}deleteUser(e){const t="/user/delete";return this._post(t,{id:e})}updateUserRole(e){const t="/user/update/role";return this._post(t,e)}updateUserPassword(e){const t="/user/update/password";return this._post(t,e)}resetUserPassword(e){const t="/user/reset/password";return this._post(t,e)}getSysInfo(){const e="/sys/useage";return this.http.get(e)}getToolMemu(){const e="/tool/menu";return this.http.get(e)}getToolUsageCount(){const e="/tool/usage/count";return this.http.get(e)}getWebAccessInfo(){const e="/web/access/info";return this.http.get(e)}}var rt=new lt;const it=(0,a.Ef)(p);for(const[nt,dt]of Object.entries(b))it.component(nt,dt);it.use(f.A),it.use(Je),it.config.globalProperties.$auth=tt,it.config.globalProperties.$http=rt,it.mount("#app")}},t={};function s(a){var o=t[a];if(void 0!==o)return o.exports;var l=t[a]={exports:{}};return e[a].call(l.exports,l,l.exports,s),l.exports}s.m=e,function(){var e=[];s.O=function(t,a,o,l){if(!a){var r=1/0;for(u=0;u<e.length;u++){a=e[u][0],o=e[u][1],l=e[u][2];for(var i=!0,n=0;n<a.length;n++)(!1&l||r>=l)&&Object.keys(s.O).every(function(e){return s.O[e](a[n])})?a.splice(n--,1):(i=!1,l<r&&(r=l));if(i){e.splice(u--,1);var d=o();void 0!==d&&(t=d)}}return t}l=l||0;for(var u=e.length;u>0&&e[u-1][2]>l;u--)e[u]=e[u-1];e[u]=[a,o,l]}}(),function(){s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,{a:t}),t}}(),function(){s.d=function(e,t){for(var a in t)s.o(t,a)&&!s.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})}}(),function(){s.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){var e={524:0};s.O.j=function(t){return 0===e[t]};var t=function(t,a){var o,l,r=a[0],i=a[1],n=a[2],d=0;if(r.some(function(t){return 0!==e[t]})){for(o in i)s.o(i,o)&&(s.m[o]=i[o]);if(n)var u=n(s)}for(t&&t(a);d<r.length;d++)l=r[d],s.o(e,l)&&e[l]&&e[l][0](),e[l]=0;return s.O(u)},a=self["webpackChunkpersonalweb_cms"]=self["webpackChunkpersonalweb_cms"]||[];a.forEach(t.bind(null,0)),a.push=t.bind(null,a.push.bind(a))}();var a=s.O(void 0,[504],function(){return s(4291)});a=s.O(a)})();
//# sourceMappingURL=app.04d8accf.js.map